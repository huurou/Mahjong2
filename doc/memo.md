# メモ

## 2025/05/06

電脳麻将の本を買ったので見ながらフローや山を実装する

通信の可能性も考えるとしてどういうインターフェースにするか
ローカル：Playerのメソッド呼び出し
リモート：クライアントにメッセージ送信
インターフェース内でgRPCサーバー起動
接続クライアントの管理と各クライアントのストリーム読み出し？
クライアントは普通にそれぞれの応答用のメッセージを飛ばすとすると、
常に読み出している必要はない
ただインターフェース的には戻り値で何かを返すのは難しそう
イベントの形でクライアントからの返信を通知することになるか

プレイヤーのIDを管理して、どのプレイヤーに対してどのメッセージを送ろうとしているのか
という形で通知するのがよさそう



## 2025/05/05

https://github.com/mjx-project/mjx/tree/master
麻雀AI強化学習環境らしい
https://note.com/oshizo/n/nbbcfb4e24908

パオのこと何も考えてなかった

役のenumの数字は天鳳かなにかに合わせたい

.Libプロジェクト内にプレイヤーやゲームも入れることにする
またInternalsフォルダもやめることにする
先にフォルダ構造を決めてみたい

Tileは点数計算のための牌種類を示すものとして作成していたが、対局管理も含めるのでTileKindに変更する必要がある

TileとTileKindを用意すると副露の表現にTileを使用したものとTileKindを使用したものが生まれてめんどくさいかも
副露の表現をTileを使用したもののみにする という手もある
だがそれをすると点数計算に不要なものまで持っているものを使用することになる
境界づけられたコンテキスト的考えで行くとそれは分けたほうがいいのか？

別プロジェクトにすることにした
点数計算プロジェクトでのTileとは牌種類のみで同一絵柄の牌は区別しないTile TileKindの方が適切ではあるが、冗長さがあったのでTileにした
ゲームプロジェクトでのTileは全ての牌を区別しIDを持つものとする

一人麻雀もできるようにプレイヤーの人数は決めないようにする
ただし点数の分配が謎になる 適当に実装するか

山のシャッフルは天鳳流にいつかしたいのでインターフェースを介するようにする

とりあえずMahjong2.LibをMahjong2.Lib.Scoringにした

外部から点数計算とシャンテン計算を呼び出せるようにする必要がある
それ用のクラスを作る or CommonプロジェクトにTileとかを用意するか
そもそも引数に何を置く？Dtoを用意するのが妥当？

## 2025/05/04

一通り実装した カバレッジも99% AI様々すぎる

全てのクラスをinternalにして外部呼び出し用のクラス郡を設計する
他のライブラリを参考にするが現状考えているのは

- シャンテン数の計算
- 点数の計算
  - 符
  - 翻
  - 役
  - ツモ・ロンに応じた点数

WinSituationやGameRulesについても見直す？

山の生成 管理 配牌 打牌 鳴き 局の進行 点数の管理 といった全ての麻雀ゲームで共通の部分は確かにライブラリにできる
今と同じプロジェクトで行うかは悩ましいが作りたい
同種の牌を点数計算ライブラリは区別する必要がないが、対局管理ライブラリは区別する必要がある という点では分ける理由になる
https://github.com/kobalab/majiang-core.git
俺が頑張って書いたのってUtil程度ってこと…！？

## 2025/05/03

大体実装できて残すは手牌から最終的な点数を出すところのみとなった

天和は仕様上和了牌をnullで渡すものとする
和了牌が書いてあっても無視するような感じにする

## 2025/04/29

シャンテン数計算実装

よくあるタスクをまとめてみた

テストコードを書かせたり変換させるのがとてもよい

## 2025/04/28

数え役満のルールとダブル役満で矛盾が生じるかも
ダブル役満は26翻ということにしたいが、数え役満が13翻で打ち切りならただの役満扱いになってしまう
IsYakumanがTrueのときは26翻はダブル役満 IsYakumanがFalseのときは数え役満のルールに従うようにする必要がある

符と翻から点数を計算できるようになった

文字列から牌の集合を作るメソッドについて
数牌は数字でいいが、字牌をどうするか
前は数字だったが文字にしてみる？
東:t 南:n 西:s 北:p
白:h 發:r 中:c
發は白と被らないように緑發の頭文字でr

副露について
副露自体は鳴き種別を保持したTileListという感じ
和了判定に於いては手牌とは別のものとして考える

シャンテン数の計算は同じ形でも繰り返しスキャンを行う実装になっていた気がする
すでにその形の分解が済んでいるものは登録しておくとパフォーマンスが良くなりそう

役のテストは書くのも考えるのも大変すぎる
一応全部通るテストは何かしら書きたいが…

## 2025/04/27

何回やり直したかわからないが、改めて麻雀を作る
今回はAIの力も借りてGW中にある程度形にしたい

とりあえずいつもの点数計算ライブラリを作る

それができたら一人麻雀練習機を作っても良い
AIの実験にもなる

牌の集合の区切り方にはいつも悩まされる
とりあえず前と同じように牌<牌の集合<牌の集合の集合で作る

牌の数の配列はやらない
とてもいいアイデアではあるが、有効的な場面が限定的な気がする

テストコードをAIはいい感じに書いてくれるだろうか

できるだけrecordで頑張る

Tileの実装がまず悩ましい
案は2つ
- 牌種類プロパティを持ち、Tileレコードのインスタンスとする
- Tileレコードを継承した各種類のレコードを作成する
AIに聞いてみる
1つ目の案にしろと言われた
まあ気持ちはわかるけどなんとなく2つ目の案でやってみる
